---
title: 代码优化技巧
date: 2024-08-21
categories:
    - frontend-optimization
tags:
    - performance
    - javascript
    - css
    - optimization
series: 前端优化实战
sticky: 0
isShowComments: true
---

# 代码优化技巧

代码层面的优化是前端性能优化的基础。通过优化 JavaScript 和 CSS 代码，我们可以显著提升应用的性能和用户体验。

## JavaScript 优化

### 1. 减少 DOM 操作

DOM 操作是 JavaScript 中最昂贵的操作之一。应该尽量减少 DOM 访问和修改。

**不好的做法：**

```javascript
// 多次访问 DOM
for (let i = 0; i < 1000; i++) {
    document.getElementById('list').innerHTML += '<li>Item ' + i + '</li>';
}
```

**优化后：**

```javascript
// 使用文档片段批量操作
const fragment = document.createDocumentFragment();
const list = document.getElementById('list');

for (let i = 0; i < 1000; i++) {
    const li = document.createElement('li');
    li.textContent = 'Item ' + i;
    fragment.appendChild(li);
}

list.appendChild(fragment);
```

### 2. 事件委托

使用事件委托可以减少事件监听器的数量，提升性能。

```javascript
// 不好的做法：为每个元素添加监听器
document.querySelectorAll('.item').forEach(item => {
    item.addEventListener('click', handleClick);
});

// 优化后：使用事件委托
document.getElementById('container').addEventListener('click', (e) => {
    if (e.target.classList.contains('item')) {
        handleClick(e);
    }
});
```

### 3. 防抖和节流

对于频繁触发的事件，使用防抖或节流来限制执行频率。

```javascript
// 防抖：延迟执行
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// 节流：限制执行频率
function throttle(func, limit) {
    let inThrottle;
    return function(...args) {
        if (!inThrottle) {
            func.apply(this, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// 使用示例
window.addEventListener('scroll', throttle(handleScroll, 100));
```

### 4. 使用 Web Workers

对于计算密集型任务，使用 Web Workers 避免阻塞主线程。

```javascript
// main.js
const worker = new Worker('worker.js');
worker.postMessage({ data: largeArray });
worker.onmessage = (e) => {
    console.log('结果:', e.data);
};

// worker.js
self.onmessage = (e) => {
    const result = e.data.data.map(item => {
        // 复杂计算
        return processItem(item);
    });
    self.postMessage(result);
};
```

### 5. 代码分割和懒加载

使用动态导入实现代码分割和懒加载。

```javascript
// 路由懒加载
const Home = () => import('./components/Home.vue');
const About = () => import('./components/About.vue');

// 条件加载
if (condition) {
    const module = await import('./heavy-module.js');
    module.doSomething();
}
```

## CSS 优化

### 1. 避免深层嵌套

CSS 选择器的嵌套深度会影响性能。

```css
/* 不好的做法：深层嵌套 */
.container .wrapper .content .item .link {
    color: blue;
}

/* 优化后：扁平化选择器 */
.content-item-link {
    color: blue;
}
```

### 2. 使用高效的选择器

某些选择器比其他选择器更高效。

```css
/* 高效：ID 和类选择器 */
#header { }
.content { }

/* 低效：属性选择器和伪类 */
[data-attribute="value"] { }
:nth-child(odd) { }
```

### 3. 避免使用 @import

`@import` 会阻塞渲染，应该使用 `<link>` 标签。

```html
<!-- 不好的做法 -->
<style>
    @import url('styles.css');
</style>

<!-- 优化后 -->
<link rel="stylesheet" href="styles.css">
```

### 4. 使用 CSS 变量

CSS 变量可以减少重复代码，提升维护性。

```css
:root {
    --primary-color: #3498db;
    --spacing-unit: 8px;
}

.button {
    background-color: var(--primary-color);
    padding: calc(var(--spacing-unit) * 2);
}
```

### 5. 关键 CSS 内联

将首屏关键 CSS 内联到 HTML 中，减少渲染阻塞。

```html
<head>
    <style>
        /* 关键 CSS */
        .header { ... }
        .hero { ... }
    </style>
    <link rel="stylesheet" href="non-critical.css">
</head>
```

## 代码组织优化

### 1. 模块化

使用 ES6 模块或 CommonJS 进行代码组织。

```javascript
// utils.js
export function formatDate(date) {
    // ...
}

export function debounce(func, wait) {
    // ...
}

// main.js
import { formatDate, debounce } from './utils.js';
```

### 2. Tree Shaking

移除未使用的代码，减少打包体积。

```javascript
// 使用具名导入而不是默认导入
import { specificFunction } from './module.js';
// 而不是
import * as module from './module.js';
```

### 3. 使用现代 JavaScript

利用现代 JavaScript 特性提升性能和可读性。

```javascript
// 使用箭头函数
const double = x => x * 2;

// 使用解构
const { name, age } = user;

// 使用模板字符串
const message = `Hello, ${name}!`;

// 使用 async/await
async function fetchData() {
    const response = await fetch('/api/data');
    return response.json();
}
```

## 性能监控

### 使用 Performance API

```javascript
// 测量函数执行时间
function measurePerformance(func) {
    const start = performance.now();
    func();
    const end = performance.now();
    console.log(`执行时间: ${end - start}ms`);
}

// 使用 Performance Observer
const observer = new PerformanceObserver((list) => {
    for (const entry of list.getEntries()) {
        console.log(entry.name, entry.duration);
    }
});
observer.observe({ entryTypes: ['measure', 'navigation'] });
```

## 总结

代码优化是一个持续的过程：

1. **编写高效的代码**：减少不必要的计算和 DOM 操作
2. **使用现代工具**：利用构建工具进行代码优化
3. **持续监控**：定期检查代码性能
4. **团队规范**：建立代码规范和最佳实践

---

**下一步**：阅读 [资源加载优化](/series/系列1/文档3)，学习如何优化图片、字体等资源的加载。

