import{_ as s,c as a,a as e,o as l}from"./app-K0L0DjBj.js";const i={};function p(t,n){return l(),a("div",null,[...n[0]||(n[0]=[e(`<h2 id="一、什么是防腐层" tabindex="-1"><a class="header-anchor" href="#一、什么是防腐层"><span>一、什么是防腐层？</span></a></h2><p>防腐层（Anti-Corruption Layer，简称 <strong>ACL</strong>）并不是某个具体的框架或技术，而是一种<strong>架构设计思想</strong>，最早来源于<strong>领域设计驱动（DDD）</strong>。</p><p>**具体解释：**将【自己系统】与【外部系统】之间加的”隔离和翻译层“，用于防止【外部系统】的设计问题污染自己的核心业务代码。唯一目的就是保证核心业务模型的纯净与稳定。</p><p><strong>通俗理解：<strong>可以把你的系统想象成一杯</strong>干净的水</strong>，而外部系统是一条<strong>水质不稳定的河流</strong>。你不会直接把河水倒进杯子里，而是：</p><ol><li>过滤</li><li>净化</li><li>再使用</li></ol><p>这个“过滤器”，就是 <strong>防腐层</strong>。</p><h2 id="二、为什么需要防腐层" tabindex="-1"><a class="header-anchor" href="#二、为什么需要防腐层"><span>二、为什么需要防腐层？</span></a></h2><p>在真实的java项目中，我们经常需要对接：</p><ul><li><p>对接老系统（历史包袱重）</p></li><li><p>第三方系统（不可控）</p></li><li><p>外部微服务（随时可变更）</p></li></ul><p>这些系统通常存在以下问题：</p><ul><li>字段命名混乱</li><li>数据结构不合理</li><li>接口定义不清晰</li><li>技术实现五花八门（HTTP / RPC / MQ / SOAP）</li><li>接口变更频繁</li></ul><p>如果<strong>业务代码直接依赖这些接口</strong>，会带来严重后果：</p><ul><li>业务逻辑被迫适配外部设计</li><li>外部接口一改，内部大量代码跟着改</li><li>核心代码可读性、可维护性急剧下降</li></ul><p>这正是防腐层要解决的问题。</p><hr><h2 id="三、防腐层在-java-项目中的位置" tabindex="-1"><a class="header-anchor" href="#三、防腐层在-java-项目中的位置"><span>三、防腐层在 Java 项目中的位置</span></a></h2><p>一个典型的 Java 分层结构如下：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Controller</span>
<span class="line">   ↓</span>
<span class="line">Application / Service</span>
<span class="line">   ↓</span>
<span class="line">Domain（核心业务模型）</span>
<span class="line">   ↓</span>
<span class="line">【防腐层 ACL】</span>
<span class="line">   ↓</span>
<span class="line">外部系统 / 第三方系统 / 老系统</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>关键原则：</strong></p><ul><li>核心业务层 <strong>绝不</strong> 直接依赖外部系统</li><li>所有外部交互必须经过防腐层</li></ul><h2 id="四、防腐层具体做什么" tabindex="-1"><a class="header-anchor" href="#四、防腐层具体做什么"><span>四、防腐层具体做什么？</span></a></h2><h3 id="_1️⃣-接口适配-翻译" tabindex="-1"><a class="header-anchor" href="#_1️⃣-接口适配-翻译"><span>1️⃣ 接口适配（翻译）</span></a></h3><p>将外部系统的数据结构，转换为内部系统可理解的领域模型。</p><p><strong>外部系统返回：</strong></p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;usr_nm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;age_flag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>防腐层转换后：</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">User</span> <span class="token punctuation">{</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    isAdult <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_2️⃣-隔离变化" tabindex="-1"><a class="header-anchor" href="#_2️⃣-隔离变化"><span>2️⃣ 隔离变化</span></a></h3><ul><li>外部接口字段变更</li><li>返回结构调整</li><li>协议升级</li></ul><p>👉 <strong>只修改防腐层，业务代码不动</strong>。</p><hr><h3 id="_3️⃣-屏蔽技术细节" tabindex="-1"><a class="header-anchor" href="#_3️⃣-屏蔽技术细节"><span>3️⃣ 屏蔽技术细节</span></a></h3><p>防腐层对上层暴露的是：</p><ul><li>领域对象</li><li>领域语义的方法</li></ul><p>而不是：</p><ul><li>HTTP / RPC 细节</li><li>JSON / XML 结构</li><li>超时、重试等技术细节</li></ul><hr><h3 id="_4️⃣-保护与兜底" tabindex="-1"><a class="header-anchor" href="#_4️⃣-保护与兜底"><span>4️⃣ 保护与兜底</span></a></h3><p>防腐层通常还会负责：</p><ul><li>异常转换</li><li>超时处理</li><li>降级逻辑</li><li>默认值处理</li></ul><p>防止外部系统不稳定直接影响核心业务。</p><hr><h2 id="五、没有防腐层与有防腐层对比" tabindex="-1"><a class="header-anchor" href="#五、没有防腐层与有防腐层对比"><span>五、没有防腐层与有防腐层对比</span></a></h2><h3 id="没有防腐层-反例" tabindex="-1"><a class="header-anchor" href="#没有防腐层-反例"><span>没有防腐层（反例）</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Service</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ThirdResponse</span> resp <span class="token operator">=</span> thirdApi<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 业务逻辑</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>问题：</strong></p><ul><li>业务代码直接依赖第三方结构</li><li>可读性差</li><li>维护成本极高</li></ul><hr><h3 id="使用防腐层-推荐" tabindex="-1"><a class="header-anchor" href="#使用防腐层-推荐"><span>使用防腐层（推荐）</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAcl</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">ThirdResponse</span> resp <span class="token operator">=</span> thirdApi<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">UserTranslator</span><span class="token punctuation">.</span><span class="token function">toUser</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Service</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">User</span> user <span class="token operator">=</span> userAcl<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">isAdult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 纯业务逻辑</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>优势：</strong></p><ul><li>业务语义清晰</li><li>外部变化可控</li><li>易测试、易维护</li></ul><hr><h2 id="六、防腐层常见命名方式" tabindex="-1"><a class="header-anchor" href="#六、防腐层常见命名方式"><span>六、防腐层常见命名方式</span></a></h2><p>在实际项目中，防腐层可能叫：</p><ul><li><code>xxxAcl</code></li><li><code>xxxAdapter</code></li><li><code>xxxFacade</code></li><li><code>xxxClient</code></li><li><code>xxxGateway</code></li></ul><p>名字不重要，<strong>职责才重要</strong>。</p><hr><h2 id="七、什么时候一定要引入防腐层" tabindex="-1"><a class="header-anchor" href="#七、什么时候一定要引入防腐层"><span>七、什么时候一定要引入防腐层？</span></a></h2><p>强烈建议在以下场景使用：</p><ul><li>对接第三方系统</li><li>对接老系统</li><li>微服务之间边界不清</li><li>项目生命周期较长</li><li>核心业务复杂</li></ul><hr><h2 id="八、防腐层不是银弹" tabindex="-1"><a class="header-anchor" href="#八、防腐层不是银弹"><span>八、防腐层不是银弹</span></a></h2><p>需要注意：</p><ul><li>防腐层不是越多越好</li><li>内部模块之间不必强行加 ACL</li><li>简单系统可以适当简化</li></ul><p><strong>是否使用，取决于系统复杂度与演进预期。</strong></p><hr><h2 id="九、总结" tabindex="-1"><a class="header-anchor" href="#九、总结"><span>九、总结</span></a></h2><p>防腐层的本质，不是增加代码层级，而是为系统建立清晰边界。</p>`,71)])])}const o=s(i,[["render",p]]),r=JSON.parse('{"path":"/blogs/java/Javaxiangmuzhongdefangfucengjieshaoyushijian.html","title":"Java项目中的防腐层介绍与实践","lang":"zh-CN","frontmatter":{"title":"Java项目中的防腐层介绍与实践","date":"2026-01-06T00:01:00.000Z","categories":["java"],"tags":["java","防腐层","设计思想"]},"headers":[{"level":2,"title":"一、什么是防腐层？","slug":"一、什么是防腐层","link":"#一、什么是防腐层","children":[]},{"level":2,"title":"二、为什么需要防腐层？","slug":"二、为什么需要防腐层","link":"#二、为什么需要防腐层","children":[]},{"level":2,"title":"三、防腐层在 Java 项目中的位置","slug":"三、防腐层在-java-项目中的位置","link":"#三、防腐层在-java-项目中的位置","children":[]},{"level":2,"title":"四、防腐层具体做什么？","slug":"四、防腐层具体做什么","link":"#四、防腐层具体做什么","children":[{"level":3,"title":"1️⃣ 接口适配（翻译）","slug":"_1️⃣-接口适配-翻译","link":"#_1️⃣-接口适配-翻译","children":[]},{"level":3,"title":"2️⃣ 隔离变化","slug":"_2️⃣-隔离变化","link":"#_2️⃣-隔离变化","children":[]},{"level":3,"title":"3️⃣ 屏蔽技术细节","slug":"_3️⃣-屏蔽技术细节","link":"#_3️⃣-屏蔽技术细节","children":[]},{"level":3,"title":"4️⃣ 保护与兜底","slug":"_4️⃣-保护与兜底","link":"#_4️⃣-保护与兜底","children":[]}]},{"level":2,"title":"五、没有防腐层与有防腐层对比","slug":"五、没有防腐层与有防腐层对比","link":"#五、没有防腐层与有防腐层对比","children":[{"level":3,"title":"没有防腐层（反例）","slug":"没有防腐层-反例","link":"#没有防腐层-反例","children":[]},{"level":3,"title":"使用防腐层（推荐）","slug":"使用防腐层-推荐","link":"#使用防腐层-推荐","children":[]}]},{"level":2,"title":"六、防腐层常见命名方式","slug":"六、防腐层常见命名方式","link":"#六、防腐层常见命名方式","children":[]},{"level":2,"title":"七、什么时候一定要引入防腐层？","slug":"七、什么时候一定要引入防腐层","link":"#七、什么时候一定要引入防腐层","children":[]},{"level":2,"title":"八、防腐层不是银弹","slug":"八、防腐层不是银弹","link":"#八、防腐层不是银弹","children":[]},{"level":2,"title":"九、总结","slug":"九、总结","link":"#九、总结","children":[]}],"git":{"createdTime":1767707808000,"updatedTime":1767707808000,"contributors":[{"name":"yangxiuqing","email":"2783123570@qq.com","commits":1}]},"filePathRelative":"blogs/java/Java项目中的防腐层介绍与实践.md"}');export{o as comp,r as data};
